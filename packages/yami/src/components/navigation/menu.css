/* Menu 菜单组件 */
@utility menu {
  @apply flex w-fit flex-col flex-wrap px-1.5 py-2;
  @apply text-sm;
  @apply [--menu-active-fg:var(--primary-foreground)] [--menu-active-bg:var(--primary)];

  /* 子菜单缩进和连接线 */
  & li ul {
    @apply relative ms-4 ps-2 whitespace-nowrap;

    &::before {
      content: "";
      @apply absolute start-0 top-3 bottom-3;
      @apply bg-border opacity-50;
      width: 1px;
    }
  }

  /* 隐藏未展开的下拉菜单 */
  & li > .menu-dropdown:not(.menu-dropdown-show) {
    @apply hidden;
  }

  /* 菜单项基础样式 */
  & li:not(.menu-title) > *:not(ul, details, .menu-title, .btn),
  & li:not(.menu-title) > details > summary:not(.menu-title) {
    @apply grid grid-flow-col content-start items-center gap-2;
    @apply px-2 py-1.5 rounded-md;
    @apply text-start select-none;
    @apply transition-colors duration-200;
    grid-auto-columns: minmax(auto, max-content) auto max-content;
    text-wrap: balance;
  }

  /* 隐藏 details 默认箭头 */
  & li > details > summary {
    @apply outline-none;

    &::-webkit-details-marker {
      @apply hidden;
    }
  }

  /* 下拉箭头指示器 */
  & li > details > summary::after,
  & li > .menu-dropdown-toggle::after {
    content: "";
    @apply block justify-self-end;
    @apply w-1.5 h-1.5;
    @apply transition-transform duration-200;
    @apply pointer-events-none;
    rotate: -135deg;
    translate: 0 -1px;
    transform-origin: 50% 50%;
    box-shadow: 2px 2px inset;
  }

  /* 展开状态的箭头 */
  & li > details[open] > summary::after,
  & li > .menu-dropdown-toggle.menu-dropdown-show::after {
    rotate: 45deg;
    translate: 0 1px;
  }

  /* Focus 状态 */
  &
    li:not(.menu-title, .disabled)
    > *:not(ul, details, .menu-title):not(.menu-active, :active, .btn):is(
      .menu-focus,
      :focus-visible
    ),
  &
    li:not(.menu-title, .disabled)
    > details
    > summary:not(.menu-title):not(.menu-active, :active, .btn):is(
      .menu-focus,
      :focus-visible
    ) {
    @apply bg-accent/10 text-foreground cursor-pointer outline-none;
  }

  /* Hover 状态 */
  &
    li:not(.menu-title, .disabled)
    > *:not(ul, details, .menu-title):not(.menu-active, :active, .btn):hover,
  &
    li:not(.menu-title, .disabled)
    > details
    > summary:not(.menu-title):not(.menu-active, :active, .btn):hover {
    @apply bg-accent/50 cursor-pointer outline-none;
  }

  /* 分隔线（空 li） */
  & li:empty {
    @apply bg-border h-px my-2 mx-2;
  }

  /* 菜单项容器 */
  & li {
    @apply relative flex shrink-0 flex-col flex-wrap items-stretch;

    & .badge {
      @apply justify-self-end;
    }
  }

  /* 激活状态 */
  & li > *:not(ul, .menu-title, details, .btn):active,
  & li > *:not(ul, .menu-title, details, .btn).menu-active,
  & li > details > summary:active {
    @apply outline-none;
    color: var(--menu-active-fg);
    background-color: var(--menu-active-bg);
  }

  /* 禁用状态 */
  & li.menu-disabled {
    @apply text-muted-foreground/40 pointer-events-none;
  }

  /* Dropdown 内的菜单 */
  & .dropdown:focus-within .menu-dropdown-toggle::after {
    rotate: 45deg;
    translate: 0 1px;
  }

  & .dropdown-content {
    @apply mt-2 p-2;

    &::before {
      @apply hidden;
    }
  }
}

/* Menu Title 标题 */
@utility menu-title {
  @apply text-muted-foreground px-3 py-2;
  @apply text-sm font-semibold;
}

/* Menu 水平布局 */
@utility menu-horizontal {
  @apply inline-flex flex-row;

  /* 水平菜单的子菜单需要垂直布局 */
  & > li:not(.menu-title) > details > ul {
    @apply absolute ms-0 mt-4 py-2 pe-2;
    @apply bg-background rounded-lg;
    @apply shadow-lg border border-border;
    @apply flex flex-col;
    @apply min-w-max;
  }

  & > li > details > ul::before {
    content: none;
  }

  /* 确保子菜单项正常显示 */
  & > li:not(.menu-title) > details > ul > li {
    @apply w-full;
  }
}

/* Menu 垂直布局（默认） */
@utility menu-vertical {
  @apply inline-flex flex-col;

  & > li:not(.menu-title) > details > ul {
    @apply relative ms-4 mt-0 py-0 pe-0;
  }
}

/* === Menu 尺寸变体 === */

/* 超小尺寸 */
@utility menu-xs {
  & li:not(.menu-title) > *:not(ul, details, .menu-title),
  & li:not(.menu-title) > details > summary:not(.menu-title) {
    @apply py-1 rounded-md text-xs;
  }
}

/* 小尺寸 */
@utility menu-sm {
  & li:not(.menu-title) > *:not(ul, details, .menu-title),
  & li:not(.menu-title) > details > summary:not(.menu-title) {
    @apply py-1 rounded-md text-xs;
  }

  & .menu-title {
    @apply py-2;
  }
}

/* 中等尺寸（默认） */
@utility menu-md {
  & li:not(.menu-title) > *:not(ul, details, .menu-title),
  & li:not(.menu-title) > details > summary:not(.menu-title) {
    @apply px-3 py-1.5 rounded-md text-sm;
  }

  & .menu-title {
    @apply px-3 py-2;
  }
}

/* 大尺寸 */
@utility menu-lg {
  & li:not(.menu-title) > *:not(ul, details, .menu-title),
  & li:not(.menu-title) > details > summary:not(.menu-title) {
    @apply px-3 py-1.5 rounded-md text-lg;
  }

  & .menu-title {
    @apply px-43 py-3;
  }
}

/* 超大尺寸 */
@utility menu-xl {
  & li:not(.menu-title) > *:not(ul, details, .menu-title),
  & li:not(.menu-title) > details > summary:not(.menu-title) {
    @apply px-4 py-1.5 rounded-md text-xl;
  }

  & .menu-title {
    @apply px-4 py-3;
  }
}

/* Menu Active 激活状态（可单独使用） */
@utility menu-active {
  @apply outline-none;
  color: var(--menu-active-fg);
  background-color: var(--menu-active-bg);
}
